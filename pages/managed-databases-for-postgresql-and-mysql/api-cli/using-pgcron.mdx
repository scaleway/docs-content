---
meta:
 title: Setting up and using the pgcron extension
 description: This page explains how to set up and use the pgcron extension.
content:
 h1: Setting up and using the pgcron extension
 paragraph: This page explains how to set up and use the pgcron extension.
tags: managed-database postgresql pgcron pg-extensions
dates:
 validation: 2025-02-17
 posted: 2025-02-17
categories:
 - managed-databases
 - postgresql-and-mysql
---

The pg_cron extension for PostgreSQL is used to execute periodic tasks. You can schedule SQL tasks, such as queries and data imports, using jobs that run at the intervals you set. This allows you to automate the tasks and run them regularly, on a daily, weekly or monthly basis, for example.

The `pgcron` extension is available with Scaleway Managed Databases for PostgreSQL. The extension is natively loaded in the `shared_preload_libraries` of the Database Instances by default.

<Macro id="requirements" />

- A Scaleway account logged into the [console](https://console.scaleway.com)
- [Owner](/iam/concepts/#owner) status or [IAM permissions](/iam/concepts/#permission) allowing you to perform actions in the intended Organization
- A [Database Instance](/managed-databases-for-postgresql-and-mysql/how-to/create-a-database/) running a PostgreSQL engine

## Installing pgcron

1. Run the following command to install the extension:

```sql
rdb=> CREATE EXTENSION pg_cron;
CREATE EXTENSION
```

## Configuring pg_cron

To fully use the extension, you must grant read/write rights to the user who will be running the `pg_cron` functions to manage jobs on the database.

<Message type="note">
  Refer to the [How to add users to a PostgreSQL or MySQL Database Instance](/managed-databases-for-postgresql-and-mysql/how-to/add-users) documentation for more information.
</Message>

## Scheduling jobs

Jobs allow you to define the SQL command or task you want to run based on a cron schedule.

To schedule jobs, you can run the following command in the SQL client:
```sql
SELECT cron.schedule(
  '${JOB_NAME}',
  '${SCHEDULE_SPEC}',
  $$
    ${SQL_COMMAND}
  $$
);
```

Replace the variables with the corresponding information:

- `${JOB_NAME}` - set a name for the job
- `${SCHEDULE_SPEC}` - the schedule specification in [cron format](/serverless-jobs/reference-content/cron-schedules/)
- `${SQL_COMMAND}` - the SQL command to be executed. Depending on the command, you might need to specify other parameters.

### Job examples

**Example 1 -  Deleting old data**

You can run the command below to delete old data from the `events` table every Saturday at 3:30am:

```sql
SELECT cron.schedule('30 3 * * 6', $$DELETE FROM events WHERE event_time < now() - interval '1 week'$$);
```

**Example 2 - Scheduling a VACUUM job**

You can run the command below to execute the VACUUM task every day at 10:00am.

```sql
SELECT cron.schedule('nightly-vacuum', '0 10 * * *', 'VACUUM');
```

## Listing Jobs

To list all scheduled jobs, you can run the following command:

```sql
SELECT * FROM cron.job;
```
Each job is represented by a record. You can see the following information in the response:

- `jobid` - a unique job ID
- `schedule` - the schedule specification in cron format
- `command` - the SQL command
- `database`, `username`, `nodename`, `nodeport` - connection details
- `active` - whether the job is active or not
- `jobname` - the name of the job

```sql
-[ RECORD 1 ]-------------------------------------------------------------
jobid | 1
schedule | 30 3 * * 6
command | DELETE FROM events WHERE event_time < now() - interval '1 week'
nodename | /var/run/postgresql
nodeport | 5432
database | rdb
username | myuser
active | t
jobname |
-[ RECORD 2 ]-------------------------------------------------------------
jobid | 2
schedule | 0 10 * * *
command | VACUUM
nodename | /var/run/postgresql
nodeport | 5432
database | rdb
username | myuser
active | t
jobname | nightly-vacuum
```

## Unscheduling Jobs

To unschedule a job, you can run the following command:

```sql
SELECT cron.unschedule('${JOB_ID}');
```
Replace ${JOB_ID} with the ID of the job you want to unschedule.

### Examples

To unschedule the jobs set in the previous section, you can run:

```sql
SELECT cron.unschedule(1);
```

or

```sql
SELECT cron.unschedule('nightly-vacuum');
```

## Scheduling jobs in other databases

To schedule a job in another database, you can use the `schedule_in_database` function:

```sql
SELECT cron.unschedule('${JOB_ID}');
```

```sql
SELECT cron.schedule_in_database('job-in-another-db', '0 12 * * *', 'INSERT INTO public.another_db_table values (now())', 'mydb');
schedule
----------
3
```

Note that cron.schedule_in_database runs jobs as the user who created them, so you'll need to connect as that user to execute the job.
Additionally, this function doesn't allow specifying a different user, as it would require superuser privileges.

**Editing Jobs**

To edit a job, you can use the `alter_job` function:

```sql
SELECT cron.alter_job(job_id:=3,database:='anotherdb');
-[ RECORD 1 ]
alter_job |
```

**Cron Syntax**

The schedule uses the standard cron syntax:

```
┌───────────── min (0 - 59)
│ ┌────────────── hour (0 - 23)
│ │ ┌─────────────── day of month (1 - 31) or last day of the month ($)
│ │ │ ┌──────────────── month (1 - 12)
│ │ │ │ ┌───────────────── day of week (0 - 6) (0 to 6 are Sunday to
│ │ │ │ │ Saturday, or use names; 7 is also Sunday)
│ │ │ │ │
│ │ │ │ │
* * * * *
```

**Time Zone**

The time zone of the pg_cron extension can be changed in the advanced settings of the instance: `cron.timezone`. By default, the time zone is set to GMT.