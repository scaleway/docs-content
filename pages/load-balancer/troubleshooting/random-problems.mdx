---
meta:
  title: I am experiencing RANDOM errors with my Load Balancer
  description: Troubleshoot RANDOM errors that you may experience when accessing applications served via your Load Balancer. Learn how to resolve common problems and get everything back up and running.
content:
  h1: I am experiencing RANDOM errors with my Load Balancer
  paragraph: Troubleshoot RANDOM errors that you may experience when accessing applications served via your Load Balancer. Learn how to resolve common problems and get everything back up and running.
tags: load-balancer TODO
dates:
  validation: 2025-03-06
  posted: 2025-03-06
categories:
  - network
---

## BACKEND SERVERS

## When I try to add my backend server's IP address to the Load Balancer, I get an error

CHECK THE ERROR
You have to have multicloud or be using Scaleway resources

##  When I want to add my instance's private IP to the balancer's backend configuration, it tells me that this IP doesn't exist. 
    
This error occurs because your IPs range is not in the private blocks IPs as describe in RFC1918.

https://en.wikipedia.org/wiki/Private_network

Scaleway allow only our public IPs or private IP that match the RFC1918 for the LB backend service.

## How do I attach my Intsances to my LB via their private IPs via Terraform?

https://admin.internal.scaleway.com/tickets?modal-id=ticket-details&ticket-id=1464043

## My Load Balancer can't communicate with Elastic Metal backend servers over a Private Network

Ensure that the Elastic Metal servers have been correctly configured for the Privat Network. Note that additional steps are required.


## CERTIFICATE 

## I'm experiencing issues with my wildcard certificate not working and receiving HTTPS errors when trying to use a custom certificate, 

Common symptoms include certificates not being recognized or validated, or errors when trying to access subdomains. 

Suggested Solutions:  

- Verify that your wildcard certificate covers the correct domain and subdomains. Check the certificate's subject alternative name (SAN) or common name (CN) to ensure it matches the domain you're trying to secure.
- Ensure that your certificate is properly configured and installed on your load balancer. Check the load balancer's documentation for specific instructions on uploading and configuring certificates.
- If you're using a subdomain, make sure your certificate covers the correct subdomain. For example, if you're trying to secure 'subdomain.example.com', your certificate should cover '*.example.com'.
- Check the certificate's validity dates and ensure it's not expired or not yet valid.
- Consult the load balancer's documentation and the certificate issuer's documentation for specific troubleshooting steps and requirements.

# I'm experiencing DNS errors when creating an SSL certificate

You may be experiencing error messages such as 

```
invalid argument(s): dns_name does not respect constraint / does not resolve to your Load Balancer IP
```

- Verify that the DNS entry is correctly set up and points to the Load Balancer IP address.
- After updating DNS entries, Wait for 30-60 minutes after updating the DNS entry to allow for propagation delay.
- Try generating the SSL certificate again after the propagation delay has passed.
- If the error persists, check the DNS entry using a tool like dig to ensure it is resolving correctly.

## I am experiencing errors creating Let's Encrypt SSL certificate with Load Balancer

You may be receiving "HTTP error 400: The port 80 frontend must be associated to an HTTP backend" error. 

- Verify that the backend is configured to use the HTTP protocol.
- Ensure that the frontend is correctly associated with the HTTP backend.
- Check the frontend configuration to ensure it is linked to the correct HTTP backend.
- If the backend is not already configured for HTTP, update or create a new backend with the HTTP protocol specified.
- Verify that the frontend is listening on port 80 and the backend is configured for the correct port corresponding to your service.
- Review the Load Balancer documentation on configuring frontends for additional guidance: https://www.scaleway.com/en/docs/load-balancer/reference-content/configuring-frontends/ 

## I'm experiencing issues with SSL certificates not being resolved when accessing my Kubernetes load balancers from within the cluster

Key Points to Consider:  

- When accessing load balancers from within the cluster, Kubernetes may skip the load balancer and forward traffic in L4 to the application, causing SSL issues.
- To resolve this issue, you need to set up specific annotations on your load balancer service to instruct Kubernetes to use the hostname instead of the IP address.
     

Suggested Solution:  

- Add the following annotation to your load balancer service:  `service.beta.kubernetes.io/scw-loadbalancer-use-hostname: "true"`
- This annotation will instruct Kubernetes to use the hostname of the load balancer instead of the IP address, allowing the SSL certificates to be resolved correctly.
     
Refer to the Scaleway documentation for more information on load balancer annotations: https://github.com/scaleway/scaleway-cloud-controller-manager/blob/master/docs/loadbalancer-annotations.md#servicebetakubernetesioscw-loadbalancer-use-hostname 
    Ensure that your Kubernetes dependencies are up-to-date and that you have the latest ca-certificates installed.
    Verify that your container image is correctly configured and that the SSL certificates are properly managed within the cluster or on the Scaleway side.


## I am experiencing issues with my load balancer that has MySQL backend servers, where connections are failing and SSL certificate generation is unsuccessful. 

- Disable Proxy Protocol : Check if the proxy protocol is enabled in your backend. If so, disable it, as it may be incompatible with your database setup.
- Verify Database Configuration : Double-check your database configuration, including the host, port, username, and password, to ensure they are correct and match the load balancer settings.
- Check Load Balancer Routing : Verify that the load balancer is correctly routing requests to your database instances.
     

Issue 2: SSL Certificate Generation  

If this is the case, you can try explicitly adding an entry for letsencrypt of the type @ IN CAA 0 issue ‘letsencrypt.org’, as shown here = https://letsencrypt.org/docs/caa/

- Check CAA Records : Your domain's CAA (Certificate Authority Authorization) records may be blocking the generation of the SSL certificate. If necessary, add a CAA record for Let's Encrypt with the format @ IN CAA 0 issue 'letsencrypt.org'.
- Verify Domain Configuration : Ensure that your domain is correctly configured to point to the load balancer.
    

## COCKPIT

## I can't see any Layer 7 metrics in my Grafana dashboard

This is normal if your Load Balancer is in TCP mode.

## I can't see any Load Balancer logs in Grafana

Is this normal???



## CONFIG

## My Load Balancer's private IP address (172.16.8.2) is appearing in the backend application's logs, instead of the real client IP address. 

Use the proxy protocol annotation to retrieve the real source IP. The Scaleway support team provided documentation on how to implement this: https://www.scaleway.com/en/docs/tutorials/proxy-protocol-v2-load-balancer/ . This allowed the client to correctly log the real client IP address in the Traefik logs. 

## Security rules not being applied as expected, and I am having difficulties in filtering incoming traffic through my LB 

Key Points to Consider:  

- Security groups only apply to public IPs, not private IPs. If your instance behind a Load Balancer only has a private IP, the security group rules will not be applied.
- Security group rules will still apply to Instances serving a Load Balancer as long as they are attached by a public IP not a private one. Verify that your security group rules are correctly configured and propagated to the instances. Check that the rules correspond to the required ports, protocols, and IP addresses. Ensure that the instance is associated with the correct security group and that there are no conflicting rules blocking the traffic.
- To filter incoming traffic to your backend servers as it passes through a load balancer, you should apply security rules directly to the load balancer. Load balancers do not perform specific filtering; they redirect all authorized traffic to the backend servers, unless ACLs are configured. Consult the Scaleway documentation for more information on security groups and load balancer ACLs: https://www.scaleway.com/en/docs/instances/concepts/#security-group  and https://www.scaleway.com/en/docs/load-balancer/how-to/create-manage-acls/ 