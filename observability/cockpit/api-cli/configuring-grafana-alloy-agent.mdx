---
meta:
  title: Sending metrics to Cockpit using the Grafana Alloy agent
  description: This page provides information on how to configure the Grafana agent, push data sources, and visualize them in Grafana
content:
  h1: Configuring the Grafana agent
  paragraph: This page provides information on how to configure the Grafana agent, push data sources, and visualize them in Grafana
tags: cockpit observability grafana-alloy agent
dates:
  validation: 2024-06-25
  posted: 2024-06-25
categories:
  - observability
---


The Grafana Alloy agent is a component used in observability and monitoring setups, to collect and send metrics and logs from your applications, services, and infrastructure to observability platforms.

This page explains how to configure the Grafana Alloy agent to push your metrics. You can use it to **push your data from Scaleway resources or external resources**.

<Macro id="requirements" />

  - [Owner](/identity-and-access-management/iam/concepts/#owner) status or [IAM permissions](/identity-and-access-management/iam/concepts/#permission) allowing you to perform actions in the intended Organization
  - A Scaleway account logged into the [console](https://console.scaleway.com)
  - Retrieved your Grafana credentials
  - [Installed Grafana Alloy](https://grafana.com/docs/alloy/latest/get-started/install/)
  - Created metrics
  - A token with push permissions for metrics in the **same region as your metrics**

<Message type="important">
 - Having the default configuration on your agents might lead to more of your resources' metrics being sent, a high consumption and a high bill at the end of the month.
 - Sending metrics and logs for Scaleway resources or personal data using an external path is a billable feature. In addition, any data that you push yourself is billed, even if you send data from Scaleway products. Refer to the [product pricing](https://www.scaleway.com/en/pricing/?tags=available,managedservices-observability-cockpit) for more information.
</Message>


1. Create a folder named `config` on your local machine.
2. Create a file named `cockpit.river` inside the `config` folder.
3. Paste the following template inside `cockpit.river`:
        ```
        prometheus.exporter.unix "node" {
            set_collectors = [
                "uname",
                "cpu",
                "cpufreq",
                "loadavg",
                "meminfo",
                "filesystem",
                "netdev",
            ]
        }

        prometheus.scrape "node" {
            scrape_interval = "5s"
            scrape_timeout  = "4s"

            targets    = prometheus.exporter.unix.node.targets
            forward_to = [prometheus.remote_write.cockpit.receiver]
        }

        prometheus.remote_write "cockpit" {
            endpoint {
                url = "https://xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx.metrics.cockpit.fr-par.scw.cloud/api/v1/push"
                headers = {
                    "X-TOKEN" = "COCKPIT_TOKEN_SECRET_KEY",
                }
            }
        }
        ```
3. Replace `https://xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx.metrics.cockpit.fr-par.scw.cloud/api/v1/push` with your metrics' URL. You can retrieve it in the [Data sources tab](https://console.scaleway.com/cockpit/dataSource) of the Scaleway console.
4. Replace `COCKPIT_TOKEN_SECRET_KEY` with your token's secret key, then save your changes.
5. Open a terminal and [start Alloy](https://grafana.com/docs/alloy/latest/get-started/run/):
        ```
        brew services start alloy
        ```
6. In the same terminal, run the following command.
        ```
        alloy run config/cockpit.river
        ```
7. 
