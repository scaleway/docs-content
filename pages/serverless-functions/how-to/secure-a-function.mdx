---
title: How to secure a function
description: How to secure your Scaleway Serverless Functions effectively.
tags: functions secure private
dates:
  validation: 2025-09-01
  posted: 2023-02-01
---
import Requirements from '@macros/iam/requirements.mdx'


This page explains how to secure your function.

<Requirements />

- A Scaleway account logged into the [console](https://console.scaleway.com)
- [Owner](/iam/concepts/#owner) status or [IAM permissions](/iam/concepts/#permission) allowing you to perform actions in the intended Organization
- A [functions namespace](/serverless-functions/how-to/create-manage-delete-functions-namespace/)
- A [function](/serverless-functions/how-to/create-a-function/)
- Created an [authentication token](/serverless-functions/how-to/create-auth-token-from-console/) for your function

## Use secrets to store access keys and sensitive information

Instead of using environment variables (which are stored in clear text) for your functions, use secrets. These are pieces of information that can be used via environment variables, but are encrypted in storage.

<Message type="tip">
    You can [create an API key](/iam/how-to/create-api-keys/) and store it with secrets to grant your functions access to the [Scaleway API](https://www.scaleway.com/en/developers/api/).
</Message>

### Configure secrets from the Scaleway console

1. Click **Functions** in the **Serverless** section of the side menu. The functions page displays.
2. Click the relevant function namespace.
3. Click the name of the function for which you want to define secrets.
4. Click the **Settings** tab.
5. Scroll to the **Secrets** section of the page and click **Add secret**. Enter the **key** and **value** for your secret. Repeat for additional secrets.
    <Message type="important">
        Be careful when you type your secrets. You will not be able to read the value in the console once submitted.
    </Message>
6. Click **Save settings** to submit your secrets and redeploy your function.

### Configure secrets using the Serverless framework

Add `secret` to your function's description (more information in the [plugin documentation](https://github.com/scaleway/serverless-scaleway-functions#security-and-secret-management)).
We recommend using them with global environment variables or a `.env` file stored independently (and kept secret).

```
secret:
      secret_1: ${env:SCW_SECRET_KEY}
```
<Message type="important">
    We strongly suggest that you do not commit this in a Version Control System (VCS), and do not share your Project ID or access key. This helps to ensure the security of your configuration file, which may contain sensitive data.
</Message>

### Configure secrets using Terraform/OpenTofu

Add the following [resource description](https://registry.terraform.io/providers/scaleway/scaleway/latest/docs/resources/function) in Terraform/OpenTofu:

```
secret_environment_variables = { "key" = "secret" }
```

## Restrict access to your functions

You can set Serverless Functions as private if you want to protect your functions from unwanted or unauthorized calls.

Unauthenticated calls will be rejected, and your function will not be triggered. This feature is handy if an event triggers your function (CRON, Queues or NATS trigger) or if you put them behind an API gateway or a proxy server (see examples in [serverless-examples](https://github.com/scaleway/serverless-examples)).

### Restrict access from the Scaleway console

1. Click **Functions** in the **Serverless** section of the side menu. The functions page displays.
2. Click the relevant function namespace.
3. Click the name of the function for which you want to define secrets.
4. Click the **Security** tab.
5. Set the **Privacy Policy** of the function to **Private**.
6. If required, set up [IAM authentication](/serverless-functions/how-to/create-auth-token-from-console/) for your function.

Your function is now private, and requires an `X-Auth-Token` header to be called:

```bash
curl -H "X-Auth-Token: <YOUR_SECRET_KEY>" <YOUR_FUNCTION_ENDPOINT>
```

<Message type="important">
JWT authentication is deprecated, you must [migrate your existing functions to IAM authentication](/serverless-functions/how-to/migrate-jwt-to-iam-authentication/).
</Message>

### Restrict access using the Serverless framework

Set `privacy: private` in your function's description.

Your function is now private, and requires an `X-Auth-Token` header to be called:

```bash
curl -H "X-Auth-Token: <YOUR_SECRET_KEY>" <YOUR_FUNCTION_ENDPOINT>
```

Refer to the [How to manage authentication for private functions](/serverless-functions/how-to/create-auth-token-from-console/) documentation for more information.

### Restrict access using Terraform/OpenTofu

Set `privacy = "private"` in your Terraform/OpenTofu [resource description](https://registry.terraform.io/providers/scaleway/scaleway/latest/docs/resources/function).

You can generate access credentials to inject in other applications (containers, functions etc.) directly from Terraform/OpenTofu using the [function_token resource](https://registry.terraform.io/providers/scaleway/scaleway/latest/docs/resources/function_token).

## Advanced access control with IAM conditions

When a container is set to **Private**, you can use Scaleway IAM policy conditions to define granular access rules.
These conditions use **Common Expression Language (CEL)** to evaluate requests based on attributes like IP address, time, or user-agent.

### Restrict access by specific IP addresses

To ensure your container is only reachable from a specific office network or a trusted proxy, you can use the `inIpRange()` function.

**Example expression:**

```cel
inIpRange(request.ip, "198.51.100.0/24")
```

**Result:** Only requests originating from the `198.51.100.0/24` subnet are authorized.

### Restrict access to specific user-agents

You can restrict calls to specific tools or internal clients by checking the `request.user_agent` attribute. This is useful for ensuring only authorized automation tools (like Terraform or a specific internal bot) can trigger the service.

**Example expression:**

```cel
request.user_agent.contains("InternalAdminTool/1.0")
```

**Result:** Only requests with a User-Agent header containing "InternalAdminTool/1.0" are permitted.

### Restrict access to specific time windows

For sensitive workloads that should only be active during business hours or specific maintenance windows, you can use `request.time`.

**Example expression (Working hours in Paris):**

```cel
request.time.getDayOfWeek() != 0 && request.time.getDayOfWeek() != 6
&& request.time.getHours("Europe/Paris") >= 9
&& request.time.getHours("Europe/Paris") < 18
```

**Result:** Access is granted only Monday through Friday, between 9:00 AM and 6:00 PM Paris time.

### Combine multiple security layers

You can use logical operators like && (AND) and || (OR) to build complex security requirements.

**Example: Restrict to a specific IP OR a specific User-Agent during weekdays:**

```cel
(inIpRange(request.ip, "203.0.113.42/32") || request.user_agent.contains("TrustedCI"))
&& request.time.getDayOfWeek() != 0 && request.time.getDayOfWeek() != 6
```

**Result:** The request is allowed if it comes from the trusted IP OR the trusted CI tool, but only on weekdays.

## Set up alerts in Observability Cockpit (upcoming feature)

Using Scaleway [Observability Cockpit](/cockpit/quickstart/), a managed Grafana solution to which all your functions are connected, you can:
* Monitor your functions using the default dashboard or create custom ones.
* Set up notifications to be alerted in case of unexpected behavior.


