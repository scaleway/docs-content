---
meta:
  title: Understanding and preparing for Public Gateways v2
  description: Find out what to expect from Public Gateways v2, and get ready for deprecation of DHCP entries and the DHCP object, as well as new default behavior for IPAM mode.
content:
  h1: Understanding and preparing for Public Gateways v2
  paragraph: Find out what to expect from Public Gateways v2, and get ready for deprecation of DHCP entries and the DHCP object, as well as new default behavior for IPAM mode.
tags: public-gateways dhcp dhcp-entries api v2 ipam-mode legacy
dates:
  creation: 2025-01-23
  validation: 2025-01-23
categories: 
  - network
---

Scaleway's VPC offering is evolving, and with this comes changes for the Public Gateway product.

This document explains what to expect and how to prepare for the upcoming changes.

## Summary (TL;DR)

All Scaleway Public Gateways until now have been created and managed with the [v1 version](TODO-LINK) of the Public Gateways API, either explicitly via the API itself or other devtools, or implicitly behind the scenes of the Scaleway console. 

**We are now deprecating v1 of the API and transitioning to [v2](TODO-LINK).**

After a six month deprecation period, the Public Gateways API v1 and associated developer tools will be removed. Before this time, you must:

- Ensure that your Public Gateway is in [IPAM mode](/network/public-gateways/concepts/#ipam). Only IPAM mode gateways are compatible with v2.
- Put any non-IPAM mode ([legacy](/network/public-gateways/concepts/#ipam)) Public Gateways in IPAM mode, by detaching them and reattaching them to their Private Networks.
- Update any code or scripts you have that call version 1 of the Public Gateways API, so that they call version 2 instead.

If your Public Gateway is already in IPAM-mode, and you only manage it via the console, you will not be affected by these changes and you do not need to take any action.

## Background: DHCP and IPAM

When Scaleway originally introduced Public Gateways, they provided DHCP functionality for resources on attached Private Networks. With the [arrival of Scaleway VPC](/network/vpc/reference-content/vpc-migration/), DHCP was moved from Public Gateways to Private Networks themselves.

Scaleway also introduced [IPAM](/network/ipam/concepts/#ipam) to act as a single source of truth for the IP addressing of all Scaleway resources. DHCP uses IPAM to ensure consistent and reliable addressing across all Private Networks. 

When you [create a Private Network](/network/vpc/how-to/create-private-network/), you can either automatically generate a default IPv4 CIDR block, or define a custom block. A default IPv6 block is automatically created. When you attach resources to the Private Network, they automatically receive an IPv4 address (and, if compatible, an IPv6 address) from this block. Alternatively, you can [reserve a specific IP address](/network/ipam/how-to/reserve-ip/) from the block, and [specify this address](/network/ipam/how-to/reserve-ip/#how-to-attach-a-resource-to-a-private-network-using-a-reserved-ip-address) when attaching the resource. 

Whether you choose a custom or default CIDR block, automatic address assignment or use a reserved address, **the resource's private IP address does not risk changing** unless you detach the resource from the Private Network. To ensure that you can keep the same address for a resource even after detaching it, use the [reserve IP](/network/ipam/how-to/reserve-ip/) functionality.

## Completing the removal of DHCP from Public Gateways

Since the assignment and management of IP addresses on Private Networks is now managed by IPAM and the Private Networks themselves, we must complete the removal of the DHCP functionality from Public Gateways. This means releasing a new version (v2) of the [Public Gateways API](https://www.scaleway.com/en/developers/api/public-gateway/), which has until now retained a number of legacy DHCP functions. From this new version, you can expect:

- IPAM mode becomes default
- Deprecation of the DHCP object
- Deprecation of the `address` field
- Deprecation of DHCP entries
- New SSH bastion feature: Allowed IPs

Read on to find out more.

### IPAM mode becomes default

Scaleway Public Gateways are either in **Legacy mode** or **IPAM mode**. You can see the mode of a given gateway by:

- Checking its badge in the gateway listing page of the [Scaleway console](https://console.scaleway.com/public-gateway/public-gateways)
- Checking the value of the `is_legacy` field via the [Public Gateways API](https://www.scaleway.com/en/developers/api/public-gateway/#path-gateways-get-a-public-gateway).

<Message type="tip">
All Public Gateways created via the Scaleway console since 17 October 2023 are necessarily in IPAM mode.
</Message>

Legacy Public Gateways use a [workaround](/network/vpc/reference-content/vpc-migration/#public-gateways-and-vpc) to ensure IPAM compatibility. IPAM-mode Public Gateways are fully integrated with Scaleway's [IPAM](/network/ipam/concepts/#ipam), which manages the coherent assignment of IP addresses to the gateway itself, and resources on attached Private Networks.

Legacy mode will be deprecated going forward, and will not be compatible with v2 of the Public Gateway API. It will no longer be possible to create legacy-mode Public Gateways, all gateways will necessarily be in IPAM mode.

If you still have a legacy gateway, you must transition it to IPAM mode so that it is compatible with v2 of the API. Do this by **detaching and reattaching the Public Gateway from its Private Network**. This will update the auto-calculated `is_legacy` field and put your gateway in IPAM mode.

### Deprecation of the DHCP object

This functionality was available via the API and developer tools only (not the Scaleway console).

The [DHCP object](https://www.scaleway.com/en/developers/api/public-gateway/#path-dhcp-list-dhcp-configurations) has, until now, allowed users to define a DHCP configuration, which specified how the gateway should assign IP addresses to devices on attached Private Networks (parameters including the subnet of the DHCP server, entry validity period and more). 

When attaching a Public Gateway to a Private Network (creating a [Gateway Network](https://www.scaleway.com/en/developers/api/public-gateway/#path-gateway-networks-attach-a-public-gateway-to-a-private-network)) via the API, you can pass a DHCP object, or the ID of an existing DHCP object. 

**The DHCP object will not exist in v2 of the API**. It will no longer be possible to create or attach DHCP objects to Gateway Networks. Instead, IPAM configuration, where auto-configuration of `GatewayNetwork` is managed by IPAM, will become default, and replace any need for DHCP configuration via the Public Gateway.

For legacy gateways using the DHCP object for custom DHCP configuration, **no automatic migration of this DHCP functionality** will take place when the gateway moves into IPAM-mode. We expect users to move to the standard set-up of IPAM and Private Networks for DHCP and private IP assignment.

### Deprecation of the address field

This functionality was available via the API and developer tools only (not the Scaleway console).

When attaching a Public Gateway to a Private Network (creating a [Gateway Network](https://www.scaleway.com/en/developers/api/public-gateway/#path-gateway-networks-attach-a-public-gateway-to-a-private-network)) via the API, you can use the `address` field to define a single static IP address to assign to the Public Gateway on that Private Network.

**The `address` field will not exist in v2 of the API**. Instead, you can pass an `ipam_ip_id` to specify a reserved IP address to use for the Public Gateway on this Private Network, if you wish. Otherwise, IPAM will auto-assign an IP address from the Private Network's CIDR block to the Public Gateway.

TODO: will we automatically take care of this when legacy gateways transition to IPAM mode?

### Deprecation of DHCP entries

This functionality was available via the API and developer tools only (not the Scaleway console).

[DHCP entries](https://www.scaleway.com/en/developers/api/public-gateway/#path-dhcp-entries-list-dhcp-entries) belong to a specified `GatewayNetwork` (Public Gateway / Private Network attachment) and can hold dynamic DHCP leases or static, user-created DHCP reservations. They effectively allow the Public Gateway to assign certain IP addresses to certain resources on the Private Network.

**DHCP entries will not exist in v2 of the API**. Instead, you can rely on the default IPAM/DHCP functionality as described [above](#background-dhcp-and-ipam). The default behavior will auto-assign IP addresses to resources on the Private Network from the network's CIDR block, or you can use the IP reservation functionality to specify the IP address(es) to assign to each resource.

For custom resources, such as VMs hosted on Elastic Metal servers, you can use the IPAM API's [Attach IP to custom resource](https://www.scaleway.com/en/developers/api/ipam/#path-ips-attach-ip-to-custom-resource) method to assign IP addresses on Private Networks. This lets you associate a [reserved IP](https://www.scaleway.com/en/developers/api/ipam/#path-ips-reserve-a-new-ip) address with a resource name and MAC address.

We will automatically migrate any existing DHCP entries to IPAM for you, at the moment you put a legacy Public Gateway into IPAM mode by detaching it and reattaching it from/to its Private Network.

### SSH bastion allowed IPs

TODO

## Deprecation and removal timeline

1. [TODO-DATE] **V1 deprecation**: The Public Gateway v1 API will be deprecated. Deprecation means that the API will still function, but it is slated for removal and we do not recommended that you keep using it.
2. [TODO-DATE] **V2 release**: The Public Gateway v2 API will be released, co-existing with v1. 

    <Message type="note">
    You will be able to list and manage both v1 and v2 Gateways with the **Scaleway console**. However, all new Public Gateways created via the console after [TODO-DATE] will necessarily be v2 gateways.
    </Message>

3. [TODO-DATE - TODO-DATE] **Migration period**: You have a six month migration period to complete the following actions

    - Ensure that your Public Gateway is in [IPAM-mode](/network/public-gateways/concepts/#ipam). Only IPAM-mode gateways are compatible with v2.
    - Put any non-IPAM mode ([legacy](/network/public-gateways/concepts/#ipam)) Public Gateways in IPAM-mode, by **detaching them and reattaching them to their Private Networks**.
    - Ensure that [DHCP is activated](TODO) on all Private Networks attached to your IPAM-mode Public Gateways.
    - Update any code or scripts you have that call version 1 of the Public Gateways API, so that they call version 2 instead. This includes removing any use of the DHCP entries, DHCP objects or address fields as mentioned [above](link).

    If your Public Gateway is already in IPAM-mode, and you only manage it via the console, you will not be affected by this changes and you do not need to take any action.

4. [TODO-DATE] **V1 removal**: The Public Gateway v1 API will be removed. Any code or scripts still pointing to v1 will cease to function. We will automatically put any existing legacy Public Gateways into IPAM mode.

## FAQ

TODO

## Further help and support

If you have any questions, get in touch with us on the `#public-gateway` channel on the [Scaleway Slack Community](https://www.scaleway.com/en/docs/tutorials/scaleway-slack-community/), or [open a support ticket](https://console.scaleway.com/support/tickets/create).

The following documentation resources may be useful to you:

- [Public Gateway API Documentation](https://www.scaleway.com/en/developers/api/public-gateway/)
- [Public Gateway Main Documentation](https://www.scaleway.com/en/docs/network/public-gateways/)
- [IPAM API Documentation](https://www.scaleway.com/en/developers/api/ipam/)
- [IPAM Main Documentation](https://www.scaleway.com/en/docs/network/ipam/)
