---
meta:
  title: Setting up and using the pgaudit extension
  description: This page explains how to set up and use the pgaudit extension.
content:
  h1: Setting up and using the pgaudit extension
  paragraph: This page explains how to set up and use the pgaudit extension.
tags: managed-database postgresql pgaudit pg-extensions
dates:
  validation: 2024-03-05
  posted: 2024-03-05
categories:
  - managed-databases
  - postgresql-and-mysql
---

The `pgaudit` extension is available with Scaleway Managed Databases for PostgresSQL. The extension is a powerful monitoring and logging tool that allows you to keep track of the actions happening in your databases, and record them.

`pgaudit` allows you to log different activities in your Database Instance, or specific databases. You can keep track of who accessed your databases, what actions were performed, and when, under a [structured format](https://github.com/pgaudit/pgaudit/blob/master/README.md#format).

You can configure the extension to log only what is relevant to your audits.

## Requirements
- Be the [Owner](/identity-and-access-management/iam/concepts/#owner) of the Organization in which the actions will be performed, or an IAM user with the [necessary permissions](/identity-and-access-management/iam/concepts/#permission)
- A Scaleway account logged into the [console](https://console.scaleway.com)
- A [Database Instance](/managed-databases/postgresql-and-mysql/how-to/create-a-database) running a PostgreSQL engine

## Enabling and installing pgaudit

1. Click **PostgreSQL and MySQL** under **Managed Databases** on the side menu. A list of your Database Instances displays.
2. Click the Database Instance name or <Icon name="more" /> > **More info** to access Instance the information page.
3. Click the **Advanced settings** tab.
4. Click <Icon name="edit" />.
5. Click **+ Add parameters**.
6. Select `rdb.enable_pgaudit` in the drop-down and click the toggle to set it to `on`.
8. Click <Icon name="validate" /> to validate. Your Database Instance restarts.

    <Message type="important">
      Restarting can take up to a few dozen seconds depending on the size of your Database Instance.
    </Message>

9. [Connect to your Database Instance](/managed-databases/postgresql-and-mysql/how-to/connect-database-instance/).
10. Run the following command to install the pgaudit extension.
    ```
    CREATE EXTENSION pgaudit
    ```
    If the operation is successful, no output is returned.

## Configuring pgaudit

`pgaudit` provides two different kinds of logging: **Session audit logging** and **Object audit logging**. To use each one, you must configure the `pgaudit.log` and `pgaudit.role` settings, respectively.

Both settings can be set up at the Database Instance level, meaning that a global configuration can be applied to all databases within the Instance. You can configure them in the [advanced settings](/managed-databases/postgresql-and-mysql/concepts/#advanced-settings) of your Database Instance. You can use both settings concurrently.

`pgaudit.log` can also be configured for specific databases within your Instance.

### Setting up `pgaudit.log`

<Tabs id="pgauditlog">

  <TabsTab label="for a Database Instance">


   </TabsTab>

  <TabsTab label="for a specific database">

  </TabsTab>

</Tabs>






e- If you want to deactivate pgaudit, use `DROP EXTENSION pgaudit` and in your Advanced Settings, change the `rdb.enable_pgaudit` parameter to False. If you activate it again afterwards, the same configuration as the one that was live before the deactivation will be applied immediately.


### For the entire Database Instance
Note: these can be edited at any time and changes will be applied immediately without any connection interruption.

Edit the pgaudit.log and pgaudit.role parameters in your Advanced settings. These will be applied globally for all users and on all databases of the instance.

### For specific databases

These are examples: you would have to use your own database or role names and replace the pgaudit.log value by the classes of statements that you want logged for those environments.

If you want to fine-tune these settings at the database or role level, cf step d. If you want a finer-grained replacement for pgaudit.log = 'read, write', see Object audit logging.

d- If you want to have specific settings at the Database or role level, you would have to connect to your Postgresql instance as an admin user and use this type of command:
`ALTER DATABASE mydb SET pgaudit.log = 'all' `
`ALTER ROLE role SET pgaudit.log = 'none' `

Warning: connection needs to be reset for these changes to apply.



## Additional information
Logs are accessible via the standard PostgreSQL logging facility.
Logs format: https://github.com/pgaudit/pgaudit/blob/master/README.md#format
Object renames are logged under the name they were renamed to. (https://github.com/pgaudit/pgaudit/blob/master/README.md#caveats)
All management actions performed via API or console (e.g user/database creations and deletions) are logged, no matter the configuration. However the associated read statements are not logged (e.g select statements used to check that actions have been correctly executed).

## Recommendations
Audit logs are flushed, consuming disk space. Knowing that the log ingestion rate is 4MB per second (https://www.scaleway.com/en/docs/observability/cockpit/reference-content/cockpit-limitations/#limits-for-loki), the risk is log generation exceeding ingestion, leading to unwanted and uncontrolled growth of disk usage. If there is a risk, monitor closely the disk usage of the instance and think about updating accordingly the log_policy parameter (https://www.scaleway.com/en/developers/api/managed-database-postgre-mysql/#path-database-instances-update-a-database-instance). Keep also in mind that if the disk space is full, some audit logs may be lost.
Before activating any audit, make sure to define exactly which statements are mandatory. Some statements might not be important for auditing use cases (e.g SELECT) while generating high volume logs, taking up disk space. When it comes to SELECT and DML statements, we recommend opting for an object audit logging configuration rather than a session audit one. For more information: https://github.com/pgaudit/pgaudit?tab=readme-ov-file#usage-considerations


## Set up examples
Audit logging on all statements for all databases and roles
Set pgaudit.log = 'all' in the Advanced settings


Audit logging only on DML statements for all databases and roles
Set pgaudit.log = 'write' in the Advanced settings


Audit logging on all statements, only on one database named 'mydb'
Set pgaudit.log = 'none' in the Advanced settings
Connect to your instance as an admin user and use this command: `ALTER DATABASE mydb SET pgaudit.log = 'all'`


Audit logging for all statements except read, write for all databases and roles & audit logging on select, insert, update, delete statements only on a specific table named 'mytable' in a database named 'mydb'
Set pgaudit.log = 'function,role,ddl,misc,misc_set' & pgaudit.role = 'auditor' in the Advanced settings
Connect to your instance as an admin user and use this command: 'GRANT select, insert, update, delete on mydb.mytable to auditor'
When creating a new master role used for object audit logging, we recommend first revoking all his privileges before granting specific audit privileges, for better fine-tuning.

