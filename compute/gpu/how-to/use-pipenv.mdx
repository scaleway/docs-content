---
title: How to use the pipenv python virtual environment
description: This page explains how to use the pipenv python virtual environment with your GPU Instance
steps:
  - step: TODO
    type: HowToStep
    url: https://www.scaleway.com/en/docs/compute/gpu/use-pipenv
image: /assets/images/docs/scaleway.png
dates:
  validation: 2021-10-13
  posted: 2021-10-13
---

<Message type="important">

  Prior to **TODO-DATE**, Scaleway GPU Instances were pre-installed with [Anaconda](https://www.anaconda.com) for managing python dependencies and virtual      environments with Python. From **TODO-DATE**, Pipenv will replace Anaconda on our AI Docker images.

</Message>
  
Pipenv is a package and dependency manager for Python projects. It harnesses the power of different existing tools, bringing their functionalities together: 
  - **pip** for Python package management
  - **pyenv** for Python version management
  - **Virtualenv** for creating different virtual Python environments
  - **Pipfile** for managing project dependencies

Pipenv is pre-installed on all of Scaleway's AI Docker images for GPU Instances. A number of useful AI core packages and tools are also installed, including scipy, numpy, scikit-learn, jupyter, tensorflow and the Scakewat SDK. Depending on the container image you choose, other packages and tools will also be pre-installed, providing a convenient framework environment for you so that you can begin work immediately. For the full list of Scaleway's AI Docker images and their pre-installations, see [TODO INSERT LINK](link).

Regardless of your Docker image, you will be able to use Pipenv to install new packages and manage their versions across multiple different virtual environments if necessary.

<Message type="requirement">

- You have an account and are logged into the [Scaleway Console](https://console.scaleway.com) 
- You have created a [GPU Instance](compute/gpu/how-to/create-manage-gpu-instance)
- You have [generated your SSH key](/console/my-project/how-to/create-ssh-key/)
- You have [launched a Scaleway AI Docker image on your GPU Instance](compute/gpu/how-to/use-gpu-with-docker)

</Message>


## Using the pre-installed pipenv virtual environment

### Accessing & activating the virtual environment

The Docker container contains a pre-installed pipenv virtual environment. This is stored in a folder called `ai` in the home directory of the container. Using this pre-installed environment gives you instant access to all the libraries, packages and tools we pre-installed for you. 

1. Ensure you have [connected to your GPU Instance via SSH](TODO-LINK) and then [launched a Scaleway AI Docker container](ompute/gpu/how-to/use-gpu-with-docker). 

  <Message type="note">

  When you log into your GPU Instance, an operating system (based on Ubuntu XX.YY) is installed, along with a minimum of other packages, including [Docker](link). Pipenv is **not** pre-installed here. You must launch a Scaleway AI Docker container to access the preinstalled Pipenv environment.

  </Message>

  You are now in the home directory of the Docker container. Your command prompt should be similar to `root@11a1f374ecd7:`

2. Enter the following command to navigate to the `ai` project folder:

  `cd ai`

  Your command prompt should now be similar to `root@11a1f374ecd7:/ai#`, showing that you are in the `ai` directory.

3. Enter the following command to activate the `ai` virtual environment:

  `pipenv shell`

  Your command prompt should now be similar to `(ai-NTxBFBeG) root@11a1f374ecd7:/ai#`, the `ai-NTxBFBeG` suffix showing that you are in the activated `ai` pipenv virtual environment.

### Managing packages

You can view packages, install/uninstall packages and update packages with a few simple `pipenv` commands:

1. Enter the following command to see all the packages and dependencies that are already installed in this environment, and their versions:

  `pipenv graph`

  Not only does the output show you the installed packages and their versions, but also all the other dependencies of each package. Here is an extract of the output, showing you two installed packages (`beautifulsoup4` and `boto3`), their versions (`4.10.0` and `1.18.49` respectively), and all of their dependencies:

  ```
    beautifulsoup4==4.10.0
    - soupsieve [required: >1.2, installed: 2.2.1]
    boto3==1.18.49
      - botocore [required: <1.22.0,>=1.21.49, installed: 1.21.49]
        - jmespath [required: <1.0.0,>=0.7.1, installed: 0.10.0]
        - python-dateutil [required: <3.0.0,>=2.1, installed: 2.8.2]
          - six [required: >=1.5, installed: 1.15.0]
        - urllib3 [required: >=1.25.4,<1.27, installed: 1.26.7]
      - jmespath [required: <1.0.0,>=0.7.1, installed: 0.10.0]
      - s3transfer [required: >=0.5.0,<0.6.0, installed: 0.5.0]
        - botocore [required: <2.0a.0,>=1.12.36, installed: 1.21.49]
          - jmespath [required: <1.0.0,>=0.7.1, installed: 0.10.0]
          - python-dateutil [required: <3.0.0,>=2.1, installed: 2.8.2]
            - six [required: >=1.5, installed: 1.15.0]
          - urllib3 [required: >=1.25.4,<1.27, installed: 1.26.7]
  ```

  <Message type="tip">

    To check which version of a specific package is installed, use the command `pipenv graph | grep <package>`, replacing `<package>` with the name of the relevant package.
  
  </Message>

2. Enter the following command to install a new package:

  `pipenv install <package>`

  <Message type="tip">

    To install a specific version of a package, use the command `pipenv install <package>~=1.2`

  </Message>

3. Enter the following command to uninstall a package:

  `pipenv uninstall <package>`

4. Enter the following command to update a package:

  `pipenv update <package>`

  <Message type="tip">

    To update all packages, simply run `pipenv update`
  
  </Message>

  TODO CHECK: if the user makes changes to the preinstalled virtual environment, will these persist once the container exits? Would the ai file have to be mapped to a local volume of the Instance?

### Launching an application in your local browser

Some applications, such as [Jupyter Lab](https://jupyter.org/) or [Code Server](https://code-server.dev/), require a browser to run. You can launch these from your Docker container pipenv virtual environment, and view them in the browser of your local machine. This is thanks to the port mapping we specified when we ran the Docker container.

1. Launch an application. Here, we launch Jupyter Lab:

  `jupyter-lab`

  Within the output, you should see something similar to the following:

  ```
  Activating14:34:30.288 ServerApp] http://df88da66d38d:8888/lab?token=...
  [I 2021-10-15 14:34:30.288 ServerApp]  or http://127.0.0.1:8888/lab?token=...
  [I 2021-10-15 14:34:30.288 ServerApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).
  ```

2. On your local computer, open a browser window and enter the following URL. Replace `<ip-address>` with the IP address of your Scaleway GPU Instance.

  ```
  <ip-address>:8888/lab?token=scaleway42
  ```

  TODO: what will token be/how will they get it?

  Jupyter Lab now displays in your browser. You can use the Notebook, Console, or other features as required:

  <Lightbox src="scaleway-jupyter-lab.png" alt="" />

3. Use CTRL+C in the terminal window of your GPU Instance / Docker container to close down the Jupyter server when you've finished.

### Understanding Pipfile

Every pipenv virtual environment has its own Pipfile. The Pipfile details the dependencies of the project, taking the place of the typical `requirements.txt` file. When you create a Pipenv environment, a Pipfile is automatically generated.

1. From `ai` directory, type `ls` to list all files in this directory

  The output should be similar to the following:

  ```
  (ai-NTxBFBeG) root@43496cfae3f1:/ai# ls
  Pipfile  Pipfile.lock  code-server_3.12.0_amd64.deb  mnist.py
  ```

2. Enter the command `cat Pipfile` to view the contents of Pipfile. The following information will help you understand the output:

    - `source` specifies the sources where available apackages are added/installed from 
    - `packages` lists the packages required for the project (production and development environments)
    - `dev-packages` lists the packages required for the project (development environments only)
    - `requires` specifes the required python version for the project

  Any packages that you explicitly install with the command `pipenv install <package>` will automatically be added to the Pipfile. However, note that the pre-installed packages of the virtual environment are not listed. [TODO CHECK THIS WON'T CHANGE] You will need to add them yourself for easy installation of your project outside of the pre-installed environment. For example, if you will push your project to a Git repository, other users who clone it will be able to install all dependencies, based on the Pipfile, with the command `pipenv install`.

3. Enter the command `cat Pipfile.lock` to view the contents of Pipfile.lock.

  This file specifies which specific versions of the packages in the Pipfile should be used. This prevents packages which depend on each other being automatically upgraded, which could break your project dependency tree.

  You can lock your currently installed packages with the `pipenv lock` command. This  generates the lock file for you automatically, based on your currently installed versions.

## Creating your own pipenv virtual environments

You may wish to create your own virtual environments with Pipenv, rather than using the preinstalled `ai` environment provided by Scaleway. Here, we show you how to do so:

1. If you already activated the pre-installed `ai` virtual environment, type `exit` to leave it.

  You should now have left (deactivated) the pre-installed virtual environment, but you are still inside the Docker Container you launched. 

2. Navigate to the home directory.

  `cd ~`

  TODO: need to make sure we instruct user to create any new project folders in a directory that is mapped to Instnace local volumes?

3. Create a new project file for your new virtual environment, and navigate into it. Replace `my-proj` with the desired name for your project.

  `mkdir my-proj && cd my-proj`

4. Create a new virtual environment and generate the Pipfile:

  `pipenv install`

5. Activate the virtual environment:

  `pipenv shell`

  Carrying out a `pipenv graph` now will show that there are currently no packages or dependencies installed. Follow the instructions for [managing and installing packages](/compute/gpu/how-to/use-pipenv#managing-packages) and [/compute/gpu/how-to/use-pipenv#launching-an-application-in-your-local-browser](launching applications in your browser) to start using your new environment.

  You can repeat these instructions to create as many virtual environments as you want. You can then switch between multiple different virtual environments within this same Docker image, including Scaleway's pre-installed environment, according to your projects and needs.

## Exiting the virtual environment and the container

When you are in an activated virtual environment, your command line prompt will normally be prefixed by the name of the environment. Here, for example, from `(ai-NTxBFBeG)` we see that we are in the activated `ai` environment, and from `/ai#` that we are in the `\ai` directory of our container:

`(ai-NTxBFBeG) root@11a1f374ecd7:/ai#`

1. Type the following command to leave/deactivate the virtual environment:

  `exit`

  Your prompt should now look similar to the following. You are still in the `/ai` directory, but the environment is not activated:

  `root@11a1f374ecd7:/ai#`

2. Type the following command to exit the Docker container:

  `exit`

  Your prompt should now look similar to the following. You are still connected to your GPU Instance, but you have left the Docker container (and all of its virtual environments):

  `root@scw-name-of-instance:~#`

## Further help

See the [official Pipenv documentation](https://docs.pipenv.org/) for further help with Pipenv.
