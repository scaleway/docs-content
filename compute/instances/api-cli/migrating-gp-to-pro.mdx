---
meta:
  title: Migrating Instances - GP1 to PRO2
  description: This page explains how to migrate GP1 Instances to PRO2 using the Scaleway API and CLI
content:
  h1: Migrating Instances - GP1 to PRO2
  paragraph: This page explains how to migrate GP1 Instances to PRO2 using the Scaleway API and CLI
dates:
  validation: 2022-05-10
  posted: 2022-05-10
---

This page explains how to migrate from a GP1 Instance with local storage to a PRO2 Instance with [Block Storage](/compute/Instances/concepts/#block-volumes) using the [Scaleway APIs](https://developers.scaleway.com/en/) and the [Scaleway CLI](https://github.com/scaleway/scaleway-cli). 


<Message type="note">

  - The following procedure also applies when migrating any Instance with local storage to Instances with Block Storage.

</Message>

Local and block snapshots have different formats. To support the migration from one to the other, we use [unified snapshots](). Unified snapshots can be created from either a local or block volume and, in turn, used to create either a local or block volume.

To migrate from a source Instance with local storage to a destination Instance with Block Storage we will:

  - create a backup of the source Instance, including unified snapshots of all the source Instance's volumes,
  - create the destination Instance from the backup image

<Message type="requirement">

  - You have a [Scaleway account](/console/my-account/how-to/create-an-account/)   
  - You have [configured your API keys](/console/my-project/how-to/generate-api-key/)
  - You have created a [General Purpose Instance](/compute/Instances/concepts/#general-purpose-instance)

</Message>

## Migrating from GP1 to PRO2 via the API

1. Get the information of your source Instance. You will need data like the Instance's and the volumes' UUID in the next steps.

  ```
  curl --location --request GET 'https://api.scaleway.com/instance/v1/zones/{{zone}}/servers/<GP1-INSTANCE-UUID>' \
  --header 'Content-Type: application/json' \
  --header 'X-Auth-Token: <$SCW_SECRET_KEY>'
  ```
  ```
  GET {{baseUrl}}/instance/v1/zones/fr-par-1/servers/4295c408-aaad-456a-95a0-7f5f6c2f2354

    {
        "server": {
            "id": "4295c408-aaad-456a-95a0-7f5f6c2f2354",
            "name": "gp1-test",
            "arch": "x86_64",
            "commercial_type": "GP1-S",
            (...)
            "volumes": {
                "0": {
                    "boot": true,
                    (...)
                    "volume_type": "l_ssd",
                    (...)
                },
                "1": {
                    "boot": false,
                    (...)
                    "volume_type": "b_ssd",
                    (...)
            },
            "tags": [],
            "state": "running",
            (...)
    }
  ```

2. Stop the source Instance. 

  ```
  curl --location --request POST 'https://api.scaleway.com/instance/v1/zones/{{zone}}/servers/<GP1-INSTANCE-UUID>/action' \
  --header 'Content-Type: application/json' \
  --header 'X-Auth-Token: <$SCW_SECRET_KEY>' \
  --data-raw '{
      "action": "poweroff"
  }'
  ```
  ```
      POST {{baseUrl}}/Instance/v1/zones/fr-par-1/servers/4295c408-aaad-456a-95a0-7f5f6c2f2354/action
      {
        "action": "poweroff"
      }

      {
        "task": {
      "id": "4295c408-aaad-456a-95a0-7f5f6c2f2354",
      "description": "server_poweroff",
      "status": "pending",
      "href_from": "/servers/4295c408-aaad-456a-95a0-7f5f6c2f2354/action",
      "href_result": "/servers/4295c408-aaad-456a-95a0-7f5f6c2f2354",
      "started_at": "2022-05-11T10:25:39.288694+00:00",
      "terminated_at": null
        }
      }
  ``` 

3. Check if the Instance is in a stopped state.

  ```
  curl --location --request GET 'https://api.scaleway.com/instance/v1/zones/{{zone}}/servers/<GP1-INSTANCE-UUID>' \
  --header 'X-Auth-Token: <$SCW_SECRET_KEY>'
  ```
  ```
    GET {{baseUrl}}/Instance/v1/zones/fr-par-1/servers/4295c408-aaad-456a-95a0-7f5f6c2f2354

    {
      "server": {
	  "id": "4295c408-aaad-456a-95a0-7f5f6c2f2354",
	  "name": "gp1-test",
	  (...)
	  "state": "stopped",
	  (...)
      }
    }
  ```

4. Create a backup of the Instance. Make sure to specify `unified` as the volume type of the snapshots embedded in the backup.

  ```
  curl --location --request POST 'https://api.scaleway.com/instance/v1/zones/{{zone}}/servers/<GP1-INSTANCE-UUID/action/' \
    --header 'Content-Type: application/json' \
    --header 'X-Auth-Token: <$SCW_SECRET_KEY>' \
    --data-raw '{
      "action": "backup",
      "name": "<BACKUP-NAME>",
      "volumes": {
          "<VOLUME1-UUID>": {
              "volume_type": "unified"
          },
          "<VOLUME2-UUID>": {
              "volume_type": "unified"
          }
      }
  }'
  ```
  ```
    POST {{baseUrl}}/Instance/v1/zones/fr-par-1/servers/4295c408-aaad-456a-95a0-7f5f6c2f2354/action
    {
	"action": "backup",
	"name": "gp1-test-backup",
	"volumes": {
	    "e099a6ef-08b3-4563-ab2e-a23b3243b3e9": {
		"volume_type": "unified"
	    },
	    "133a7789-4c76-4b49-b38a-70ef7537db31": {
		"volume_type": "unified"
	    }
	}
    }
 
    {
	"task": {
	    "id": "400f529a-faf9-4171-bcba-172118713d15",
	    "description": "server_backup",
	    "status": "pending",
	    "href_from": "/servers/4295c408-aaad-456a-95a0-7f5f6c2f2354/action",
	    "href_result": "/images/34d12fd2-6792-4dcb-81d0-b3dd1a3ddc29",
	    "started_at": "2022-05-11T10:43:40.777057+00:00",
	    "terminated_at": null
	}
    }
  ```

  <Message type="note">

  You can find the GP1 image's UUID from the `href_result` task output. It will be used in the next step.

  </Message>

5. Create the target Instance from the backup. 

  ```
  url --location --request POST 'https://api.scaleway.com/instance/v1/zones/{{zone}}/servers/' \
    --header 'Content-Type: application/json' \
    --header 'X-Auth-Token: <$SCW_SECRET_KEY>' \
  --data-raw '{
      "name": "pro2-test",
      "commercial_type": "PRO2-S",
      "project": "<PROJECT-UUID>",
      "image":"<GP1-IMAGE-UUID>",
      "dynamic_ip_required": true
  }'
  ```
  ```
    POST {{baseUrl}}/Instance/v1/zones/fr-par-1/servers
    {
      "name": "pro2-test",
      "commercial_type": "PRO2-S",
      "dynamic_ip_required": true,
      "image": "34d12fd2-6792-4dcb-81d0-b3dd1a3ddc29",
      "project": "{{SCW_PROJECT_ID}}"
    }

    {
	"server": {
	    "id": "998b88d1-1d71-4a0a-8432-5965222d14a1",
	    "name": "pro2-test",
	    "arch": "x86_64",
	    "commercial_type": "PRO2-S",
	    "boot_type": "local",
	    "organization": "90f292b8-a039-465a-a31c-aa5bae5e5c19",
	    "project": "90f292b8-a039-465a-a31c-aa5bae5e5c19",
	    "hostname": "pro2-test",
	    "image": {
		"id": "34d12fd2-6792-4dcb-81d0-b3dd1a3ddc29",
		"name": "gp1-test-backup",
		"organization": "90f292b8-a039-465a-a31c-aa5bae5e5c19",
		"project": "90f292b8-a039-465a-a31c-aa5bae5e5c19",
		"root_volume": {
		    "id": "18576457-4ad7-42cc-9545-3541e78efeba",
		    "name": "gp1-test-backup_snap_0",
		    "volume_type": "unified",
		    "size": 300000000000
		},
		"extra_volumes": {
		    "1": {
			"id": "b5ca24c8-ffa3-47ae-9e4b-0a7411c30da8",
			"name": "gp1-test-backup_snap_1",
			"volume_type": "unified",
			"size": 20000000000
		    }
		},
		"public": false,
		"arch": "x86_64",
		"creation_date": "2022-05-11T10:43:40.156071+00:00",
		"modification_date": "2022-05-11T10:43:40.156071+00:00",
		"default_bootscript": {
		    "id": "40b3f0d9-113f-460b-9469-6befc3d9bdd3",
		    "public": true,
		    "title": "x86_64 mainline 4.4.230 rev1",
		    "architecture": "x86_64",
		    "organization": "11111111-1111-4111-8111-111111111111",
		    "project": "11111111-1111-4111-8111-111111111111",
		    "kernel": "http://10.194.3.9/kernel/x86_64-mainline-lts-4.4-4.4.230-rev1/vmlinuz-4.4.230",
		    "dtb": "",
		    "initrd": "http://10.194.3.9/initrd/initrd-Linux-x86_64-v3.14.6.gz",
		    "bootcmdargs": "LINUX_COMMON scaleway boot=local nbd.max_part=16",
		    "default": true,
		    "zone": "fr-par-1"
		},
		"from_server": "4295c408-aaad-456a-95a0-7f5f6c2f2354",
		"state": "available",
		"tags": [],
		"zone": "fr-par-1"
	    },
	    "volumes": {
		"0": {
		    "boot": false,
		    "id": "9a91ba85-8ede-49b7-a26c-c2bc8e11bf76",
		    "name": "gp1-test-backup_snap_0",
		    "volume_type": "b_ssd",
		    "export_uri": null,
		    "organization": "90f292b8-a039-465a-a31c-aa5bae5e5c19",
		    "project": "90f292b8-a039-465a-a31c-aa5bae5e5c19",
		    "server": {
			"id": "998b88d1-1d71-4a0a-8432-5965222d14a1",
			"name": "pro2-test"
		    },
		    "size": 300000000000,
		    "state": "available",
		    "creation_date": "2022-05-11T10:50:07.178954+00:00",
		    "modification_date": "2022-05-11T10:50:07.178954+00:00",
		    "tags": [],
		    "zone": "fr-par-1"
		},
		"1": {
		    "boot": false,
		    "id": "5f1e653b-0e66-4754-847c-3ee89efa5578",
		    "name": "gp1-test-backup_snap_1",
		    "volume_type": "b_ssd",
		    "export_uri": null,
		    "organization": "90f292b8-a039-465a-a31c-aa5bae5e5c19",
		    "project": "90f292b8-a039-465a-a31c-aa5bae5e5c19",
		    "server": {
			"id": "998b88d1-1d71-4a0a-8432-5965222d14a1",
			"name": "pro2-test"
		    },
		    "size": 20000000000,
		    "state": "available",
		    "creation_date": "2022-05-11T10:50:07.178954+00:00",
		    "modification_date": "2022-05-11T10:50:07.178954+00:00",
		    "tags": [],
		    "zone": "fr-par-1"
		}
	    },
	    "tags": [],
	    "state": "stopped",
	    "protected": false,
	    "state_detail": "",
	    "public_ip": null,
	    "ipv6": null,
	    "extra_networks": [],
	    "dynamic_ip_required": true,
	    "enable_ipv6": false,
	    "private_ip": null,
	    "creation_date": "2022-05-11T10:50:07.178954+00:00",
	    "modification_date": "2022-05-11T10:50:07.178954+00:00",
	    "bootscript": {
        "id": "40b3f0d9-113f-460b-9469-6befc3d9bdd3",
        "public": true,
        "title": "x86_64 mainline 4.4.230 rev1",
        "architecture": "x86_64",
        "organization": "11111111-1111-4111-8111-111111111111",
        "project": "11111111-1111-4111-8111-111111111111",
        "kernel": "http://10.194.3.9/kernel/x86_64-mainline-lts-4.4-4.4.230-rev1/vmlinuz-4.4.230",
        "dtb": "",
        "initrd": "http://10.194.3.9/initrd/initrd-Linux-x86_64-v3.14.6.gz",
        "bootcmdargs": "LINUX_COMMON scaleway boot=local nbd.max_part=16",
        "default": true,
        "zone": "fr-par-1"
          },
	    "security_group": {
        "id": "7d4502a3-2732-4d26-a24a-449403997ff8",
        "name": "Default security group"
          },
	    "location": null,
	    "maintenances": [],
	    "allowed_actions": [
		"poweron",
		"backup"
	    ],
	    "placement_group": null,
	    "private_nics": [],
	    "zone": "fr-par-1"
	}
    }
  ```

6. Start the target Instance.

  ```
  curl --location --request POST 'https://api.scaleway.com/instance/v1/zones/{{zone}}/servers/<pro2-instance-uuid>/action/' \
    --header 'Content-Type: application/json' \
    --header 'X-Auth-Token: <$SCW_SECRET_KEY>' \
    --data-raw '{
    "action": "poweron"
  }'
  ```
  ```

    POST {{baseUrl}}/Instance/v1/zones/fr-par-1/servers/998b88d1-1d71-4a0a-8432-5965222d14a1
    {
      "action": "poweron"
    }

    {
	"task": {
	    "id": "d7902607-2fe0-45f7-874f-72201e2654d4",
	    "description": "server_batch_poweron",
	    "status": "pending",
	    "href_from": "/servers/998b88d1-1d71-4a0a-8432-5965222d14a1/action",
	    "href_result": "/servers/998b88d1-1d71-4a0a-8432-5965222d14a1",
	    "started_at": "2022-05-11T10:52:23.222827+00:00",
	    "terminated_at": null
	}
    }
  ```
7. Check the status of the Instance. 
  ```
  curl --location --request GET 'https://api.scaleway.com/instance/v1/zones/{{zone}}/servers/<pro2-instance-uuid>' \
  --header 'Content-Type: application/json' \
  --header 'X-Auth-Token: <$SCW_SECRET_KEY>'
  ```
  ```
    GET {{baseUrl}}/Instance/v1/zones/fr-par-1/servers/998b88d1-1d71-4a0a-8432-5965222d14a1

    {
      "server": {
	  "id": "998b88d1-1d71-4a0a-8432-5965222d14a1",
	  "name": "pro2-test",
	  (...)
	  "state": "running",
	  (...)
      }
    }
  ```

<Navigation>
  <PreviousButton to="/compute/instances/api-cli/migrating-instances/">Migrating Instances</PreviousButton>
  <NextButton to="/compute/instances/api-cli/using-cloud-init/">Using cloud-init</NextButton>
</Navigation>