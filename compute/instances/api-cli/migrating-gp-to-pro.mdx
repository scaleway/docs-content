---
meta:
  title: Migrating Instances - GP1 to PRO2
  description: This page explains how to migrate GP1 Instances to PRO2 using the Scaleway API and CLI
content:
  h1: Migrating Instances - GP1 to PRO2
  paragraph: This page explains how to migrate GP1 Instances to PRO2 using the Scaleway API and CLI
dates:
  validation: 2022-05-10
  posted: 2022-05-10
---

This page explains how to migrate from a GP1 Instance with local storage to a PRO2 Instance with [Block Storage](/compute/instances/concepts/#block-volumes) using the [Scaleway APIs](https://developers.scaleway.com/en/). 


<Message type="note">

  - The following procedure also applies when migrating any Instance with local storage to any Instance with Block Storage.

</Message>

To migrate from a source Instance with local storage to a destination Instance with Block Storage we will:

  - create a [backup](/compute/instances/concepts/#backup) of the source Instance, including unified [snapshots](/compute/instances/concepts/#snapshot) of all the source Instance's volumes,
  - create the destination Instance from the backup image

Local and block snapshots have different formats. To support the migration from one to the other, we use unified snapshots. Unified snapshots can be created from either a local or block volume and, in turn, used to create either a local or block volume.

<Message type="requirement">

  - You have a [Scaleway account](/console/my-account/how-to/create-an-account/)
  - You have [configured your API keys](/console/my-project/how-to/generate-api-key/)
  - You have created a [General Purpose Instance](/compute/instances/concepts/#general-purpose-instance)
  - You have [installed](https://github.com/scaleway/scaleway-cli#scaleway-cli-v2) and [configured](https://www.scaleway.com/en/docs/compute/instances/api-cli/creating-managing-instances-with-cliv2#configuring-the-cli) the Scaleway CLI

</Message>

## Migrating from GP1 to PRO2 via the API

1. Get the information of your source Instance. You will need data like the Instance's and the volumes' UUID in the next steps.

  ```
  curl --location --request GET 'https://api.scaleway.com/instance/v1/zones/'$ZONE'/servers/'$GP1_INSTANCE_UUID'' \
  --header 'Content-Type: application/json' \
  --header 'X-Auth-Token: '$SCW_SECRET_KEY''
  ```
  Response:
  ```
  {
      "server": {
          "id": "4295c408-aaad-456a-95a0-7f5f6c2f2354",
          "name": "gp1-test",
          "arch": "x86_64",
          "commercial_type": "GP1-S",
          (...)
          "volumes": {
              "0": {
                  "boot": true,
                  "id": "$VOLUME0_UUID",
                  (...)
                  "volume_type": "l_ssd",
                  (...)
              },
              "1": {
                  "boot": false,
                  "id": "$VOLUME1_UUID",
                  (...)
                  "volume_type": "b_ssd",
                  (...)
          },
          "tags": [],
          "state": "running",
          (...)
  }
  ```

2. Create a backup of the Instance.
  
  Make sure that you:
    - Replace `$VOLUME0_UUID`, `$VOLUME1_UUID`, and so forth with volumes' UUIDs that you recovered in the first step of this tutorial. 
    - Specify `unified` as the volume type of the snapshots embedded in the backup. 

  ```
  curl --location --request POST 'https://api.scaleway.com/instance/v1/zones/'$ZONE'/servers/'$GP1_INSTANCE_UUID'/action/' \
    --header 'Content-Type: application/json' \
    --header 'X-Auth-Token: '$SCW_SECRET_KEY'' \
    --data-raw '{
      "action": "backup",
      "name": "'$BACKUP_NAME'",
      "volumes": {
        "'$VOLUME0_UUID'": {
          "volume_type": "unified"
        },
        "'$VOLUME1_UUID'": {
          "volume_type": "unified"
        }
      }
    }'
  ```
  Response:
  ```
  {
    "task": {
        "id": "400f529a-faf9-4171-bcba-172118713d15",
        "description": "server_backup",
        "status": "pending",
        "href_from": "/servers/4295c408-aaad-456a-95a0-7f5f6c2f2354/action",
        "href_result": "/images/34d12fd2-6792-4dcb-81d0-b3dd1a3ddc29",
        "started_at": "2022-05-11T10:43:40.777057+00:00",
        "terminated_at": null
    }
  }
  ```

  <Message type="note">

  You can find the GP1 backup's UUID from the `href_result` task output. It will be used in step 4.

  </Message>

3. Check the state of the backup to make it is complete.

  ```
  curl --location --request GET 'https://api.scaleway.com/instance/v1/zones/'$ZONE'/images?name='$BACKUP_NAME'' \
    --header 'Content-Type: application/json' \
    --header 'X-Auth-Token: '$SCW_SECRET_KEY''
  ```
  Response:
  ```
  {
    "images": [
      {
      (...)
      "name": "gp1-backup",
      (...)
      "state": "available",
      (...)
  ```

4. Create the target Instance from the backup. 

  ```
  curl --location --request POST 'https://api.scaleway.com/instance/v1/zones/'$ZONE'/servers/' \
  --header 'Content-Type: application/json' \
  --header 'X-Auth-Token: '$SCW_SECRET_KEY'' \
  --data-raw '{
    "name": "pro2-test",
    "commercial_type": "PRO2-S",
    "project": "'$PROJECT_UUID'",
    "image":"'$GP1_BACKUP_UUID'",
    "dynamic_ip_required": true
  }'
  ```
  Response:
  ```
  "server": {
      "id": "998b88d1-1d71-4a0a-8432-5965222d14a1",
      "name": "pro2-test",
      "arch": "x86_64",
      "commercial_type": "PRO2-S",
      (...)
      "state": "stopped",
      (...)
  }
   ```

5. Start the target Instance.

  ```
  curl --location --request POST 'https://api.scaleway.com/instance/v1/zones/'$ZONE'/servers/'$PRO2_INSTANCE_UUID'/action/' \
    --header 'Content-Type: application/json' \
    --header 'X-Auth-Token: '$SCW_SECRET_KEY'' \
    --data-raw '{
      "action": "poweron"
    }'
  ```
  Response:
  ```
  {
    "task": {
        "id": "d7902607-2fe0-45f7-874f-72201e2654d4",
        "description": "server_batch_poweron",
        "status": "pending",
        "href_from": "/servers/998b88d1-1d71-4a0a-8432-5965222d14a1/action",
        "href_result": "/servers/998b88d1-1d71-4a0a-8432-5965222d14a1",
        "started_at": "2022-05-11T10:52:23.222827+00:00",
        "terminated_at": null
    }
  }
  ```
6. Check the status of the Instance. 
  ```
  curl --location --request GET 'https://api.scaleway.com/instance/v1/zones/$ZONE/servers/'$PRO2_INSTANCE_UUID'' \
  --header 'Content-Type: application/json' \
  --header 'X-Auth-Token: '$SCW_SECRET_KEY''
  ```
  Response:
  ```
  {
    "server": {
      "id": "998b88d1-1d71-4a0a-8432-5965222d14a1",
      "name": "pro2-test",
      (...)
      "state": "running",
      (...)
    }
  }
  ```


## Migrating from GP1 to PRO2 via the CLI

1. Open a terminal and type the following command, to create a GP1 Instance:

 `scw instance server create type=GP1-S zone=fr-par-2`

 You will see an output like the following:

  ```
  ID                          123a12ab-12a1-1a12-123a-a1bc1234a123
  Name                        cli-instance-test
  Organization                0a123456-1a2b-12a3-a123-1abc0123d456
  Project                     0b123456-1b2b-12b3-b123-1bca0123d456
  AllowedActions.0            poweron
  AllowedActions.1            backup
  CommercialType              GP1-S
  CreationDate                1 second ago
  DynamicIPRequired           false
  EnableIPv6                  false
  Hostname                    cli-instance-test
  Image.ID                    0a123456-1a2b-12a3-a123-1abc0123d456
  Image.Name                  Ubuntu 20.04 Focal Fossa
  Image.Arch                  x86_64
  Image.CreationDate          5 months ago
  Image.ModificationDate      5 months ago
  Image.ExtraVolumes          0
  Image.FromServer            -
  Image.Organization          0a123456-1a2b-12a3-a123-1abc0123d456
  Image.Public                true
  Image.RootVolume            0a123456-1a2b-12a3-a123-1abc0123d456
  Image.State                 available
  Image.Project               0a123456-1a2b-12a3-a123-1abc0123d456
  Image.Zone                  fr-par-2
  Protected                   false
  PublicIP.ID                 0a123456-1a2b-12a3-a123-1abc0123d456
  PublicIP.Address            51.159.188.144
  PublicIP.Dynamic            false
  ModificationDate            1 second ago
  State                       archived
  Bootscript                  x86_64 mainline 4.4.230 rev1
  BootType                    local
  Volumes.0.ID                0a123456-1a2b-12a3-a123-1abc0123d456
  Volumes.0.Name              ubuntu_20.04_focal_fossa:volume-0
  Volumes.0.ExportURI         -
  Volumes.0.Organization      0a123456-1a2b-12a3-a123-1abc0123d456
  Volumes.0.Server.ID         0a123456-1a2b-12a3-a123-1abc0123d456
  Volumes.0.Server.Name       cli-instance-test
  Volumes.0.Size              300 GB
  Volumes.0.VolumeType        l_ssd
  Volumes.0.CreationDate      1 second ago
  Volumes.0.ModificationDate  1 second ago
  Volumes.0.State             available
  Volumes.0.Project           0b123456-1b2b-12b3-b123-1bca0123d456
  Volumes.0.Boot              false
  Volumes.0.Zone              fr-par-2
  SecurityGroup.ID            0b123456-1b2b-12b3-b123-1bca0123d456
  SecurityGroup.Name          Default security group
  StateDetail                 -
  Arch                        x86_64
  Zone                        fr-par-2
  ```

2. Type the following command to backup your Instance:

 `scw instance server backup <serverID> zone=fr-par-2 unified=true`

 You will see the following output: 

 ```
  Image.ID                 0b123456-1b2b-12b3-b123-1bca0123d456
  Image.Name               cli-backup-image
  Image.Arch               x86_64
  Image.CreationDate       now
  Image.ModificationDate   now
  Image.DefaultBootscript  x86_64 mainline 4.4.230 rev1
  Image.ExtraVolumes       0
  Image.FromServer         012n23ba-25z8-7g97-530a-m6ol1941f001
  Image.Organization       0b123456-1b2b-12b3-b123-1bca0123d456
  Image.Public             false
  Image.RootVolume         012n23ba-25z8-7g97-530a-m6ol1941f001
  Image.State              creating
  Image.Project            012n23ba-25z8-7g97-530a-m6ol1941f001
  Image.Zone               fr-par-2
  ```

3. 

<Navigation>
  <PreviousButton to="/compute/instances/api-cli/migrating-instances/">Migrating Instances</PreviousButton>
  <NextButton to="/compute/instances/api-cli/using-cloud-init/">Using cloud-init</NextButton>
</Navigation>
