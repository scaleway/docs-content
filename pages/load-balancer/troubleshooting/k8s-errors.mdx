---
meta:
  title: I am experiencing problems with my Kubernetes Load Balancer
  description: Troubleshoot problems with your Kubernetes Load Balancer
content:
  h1: I am experiencing problems with my Kubernetes Load Balancer
  paragraph: Troubleshoot problems with your Kubernetes Load Balancer
tags: load-balancer kubernetes annotations
dates:
  validation: 2025-03-06
  posted: 2025-03-06
categories:
  - network
---

You may experience errors when attempting to configure your Kubernetes Load Balancer. 

This page helps you find solutions to some of the most common problems.

### I can't add a certificate to my Kubernetes Load Balancer

Do it via annotations, not the console

If you're also using Terraform, then:
- For SSL certificate management via terraform, see
https://registry.terraform.io/providers/scaleway/scaleway/latest/docs/resources/lb_certificate
And in your "ingress_nginx" manifest ensure you have a cert-manager that you'll need to deploy via terraform.
https://registry.terraform.io/modules/terraform-iaac/cert-manager/kubernetes/latest

## I'm experiencing connectivity issues with my Kubernetes Load Balancer

Symptoms:  

- Load balancer not connecting to nodes in Kapsule cluster.
- Application inaccessible from internet.
- Health checks failing for some nodes.

Troubleshooting Steps:  

- Ensure that you provisioned and configured your Load Balancer via Kubernetes nad not via the Scaleway console, which provokes unexpected behaviours and errors, including certificate addition
- Check `externalTrafficPolicy` setting. If it is set to "Local" instead of "Cluster", this could be causing the issue. Change the policy to "Cluster".
- Try enabling or disabling Cloudflare's Proxy Mode, which may be affecting connectivity
- Verify that the required service is running on all nodes. If it is missing from some nodes, this could be causing health checks to fail.
     
## I'm using Kubernetes cluster with Traefik2 proxy, when I check the logs of Traefik DaemonSet the load balancer internal IP appears instead of real client IP.

the engineers have told us that you need to use the proxy protocol annotation to retrieve the real source IP.

The doc for the implem is here: https://www.scaleway.com/en/docs/tutorials/proxy-protocol-v2-load-balancer/

## My Load Balancer is not connecting to my Kapsule cluster nodes, resulting in my application being inaccessible from the internet. 

Potential Causes and Solutions:  

- Incorrect externalTrafficPolicy setting : Check if the externalTrafficPolicy setting in your Kubernetes configuration is set to "Local". If so, try changing it to "Cluster" to allow all nodes to expose the service and route traffic to the correct node.
- Cloudflare proxy mode enabled : If you're using Cloudflare as your DNS, CDN, WAF, etc., try disabling the proxy mode to ensure that the load balancer receives traffic from your IP address instead of Cloudflare's IP addresses.
- Nodes not running pods : Verify that all nodes in your Kapsule cluster are running pods associated with the service. If not, ensure that the pods are properly deployed and running on all nodes.
- Load balancer configuration issues : Check the load balancer configuration to ensure that it's properly set up to route traffic to all nodes in the cluster.
     
Additional Troubleshooting Steps:  

- Check the load balancer logs for any errors or warnings that may indicate the cause of the issue.
- Verify that the Kapsule cluster nodes are properly configured and running.
- Test the application by accessing it from a different location or network to rule out any issues with your local network or internet connection.
     
## My k8s Load Balancer is not behaving as expected

Do not attempt to create a Load Balancer manually and then add your ingress controller or Kubernetes nodes as backend server.

This results in unexpected behaviours, HTTP errors and incorrect traffic handling.

You must provision your Load Balancer via Kubernetes itself: see our [dedicated documentation](TODO).

## My certificate is not being resolved when accessing my Kubernetes Load Balancer from within the cluster

You may be able to reach applications from outside your cluster, but when trying to reach your Load Balancer from inside your Kapsule cluster, experience the following error message:

```
routines:ss3_get_record:wrong version number:../ssl/record/ssl3_record.c:331
```

## Cause

The Load Balancer is not properly configured to handle requests from within the cluster, specifically it is not using the hostname to route requests.

## Solution:

Add an [annotation](TODO) to the Load Balancer configuration, to use the hostname to route requests: 

```
service.beta.kubernetes.io/scw-loadbalancer-use-hostname: "true" 
```

By adding this annotation, the Load Balancer will use the hostname to route requests from within the cluster. 