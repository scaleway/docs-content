---
meta:
 title: Setting up and using the pgaudit extension
 description: This page explains how to set up and use the pgaudit extension.
content:
 h1: Setting up and using the pgaudit extension
 paragraph: This page explains how to set up and use the pgaudit extension.
tags: managed-database postgresql pgaudit pg-extensions
dates:
 validation: 2024-03-05
 posted: 2024-03-05
categories:
 - managed-databases
 - postgresql-and-mysql
---


The `pgaudit` extension is available with Scaleway Managed Databases for PostgresSQL. The extension is a powerful monitoring and logging tool that allows you to keep track of the actions happening in your databases, and record them.


`pgaudit` allows you to log different statements executed in your Database Instance, or specific databases. You can keep track of who accessed your databases, what actions were performed, and when, under a [structured format](https://github.com/pgaudit/pgaudit/blob/master/README.md#format).


You can configure the extension to log only what is relevant to your audits.


## Requirements
- Be the [Owner](/identity-and-access-management/iam/concepts/#owner) of the Organization in which the actions will be performed, or an IAM user with the [necessary permissions](/identity-and-access-management/iam/concepts/#permission)
- A Scaleway account logged into the [console](https://console.scaleway.com)
- A [Database Instance](/managed-databases/postgresql-and-mysql/how-to/create-a-database) running a PostgreSQL engine


## Enabling and installing pgaudit


1. Click **PostgreSQL and MySQL** under **Managed Databases** on the side menu. A list of your Database Instances displays.
2. Click the Database Instance name or <Icon name="more" /> > **More info** to access Instance the information page.
3. Click the **Advanced settings** tab.
4. Click <Icon name="edit" />.
5. Click **+ Add parameters**.
6. Select `rdb.enable_pgaudit` in the drop-down and click the toggle to set it to `on`.
8. Click <Icon name="validate" /> to validate. Your Database Instance restarts.
   <Message type="important">
     Restarting can take up to a few dozen seconds depending on the size of your Database Instance.
   </Message>
9. [Connect to your Database Instance](/managed-databases/postgresql-and-mysql/how-to/connect-database-instance/).
10. Run the following command to install the `pgaudit` extension.
   ```
   CREATE EXTENSION pgaudit
   ```
   If the operation is successful, no output is returned.


## Configuring pgaudit


`pgaudit` provides two different types of logging:
   - **Session audit logging** - logs the operations, such as queries and updates, executed by a user during a session within a database or the entire Database Instance
   - **Object audit logging** - logs actions that involve specific data objects, like tables or files.


To use each one, you must configure the `pgaudit.log` and `pgaudit.role` settings, respectively.


Both settings can be set up at the Database Instance level, meaning that a global configuration can be applied to all databases within the Instance. You can configure them in the [advanced settings](/managed-databases/postgresql-and-mysql/concepts/#advanced-settings) of your Database Instance. You can use both settings concurrently.


`pgaudit.log` can also be configured for specific databases within your Instance.


### Setting up `pgaudit.log`


The `pgaudit.log` setting determines which classes of statements will be recorded through session audit logging.


The possible values include:


| Class        | Action         |
| ------------ | ------------------- |
| `READ`       | Logs `SELECT` and `COPY` commands when the source is a relation or a query. |
| `WRITE`      | Logs `INSERT`, `UPDATE`, `DELETE`, `TRUNCATE`, and `COPY` commands when the destination is a relation. |
| `FUNCTION`   | Logs function calls and `DO` blocks. |
| `ROLE`       | Logs statements related to roles and privileges, such as `GRANT`, `REVOKE`, `CREATE`, `ALTER`, and `DROP` `ROLE`.        |
| `DDL`        | Covers all Data Definition Language (DDL) statements not included in the ROLE class. |
| `MISC`       | Logs miscellaneous commands like `DISCARD`, `FETCH`, `CHECKPOINT`, `VACUUM`, `SET`.   |
| `MISC_SET`   | Logs miscellaneous `SET` commands. |
| `ALL`        | Includes all of the above classes for comprehensive logging. |


<Tabs id="pgauditlog">


 <TabsTab label="for a Database Instance">


   1. Click **PostgreSQL and MySQL** under **Managed Databases** on the side menu. A list of your Database Instances displays.
   2. Click the Database Instance name or <Icon name="more" /> > **More info** to access Instance the information page.
   3. Click the **Advanced settings** tab.
   4. Click <Icon name="edit" />.
   5. Click **+ Add parameters**.
   6. Select `pgaudit.log` in the drop-down.
   7. Enter one or more of the statement class values listed above.
     <Message type="note">
       The values must be written in uppercase. If entering more than one class, separate them with a comma and no spaces. For example: `READ,WRITE`.
     </Message>
   8. Click <Icon name="validate" /> to validate.
     <Message type="note">
       The configuration takes a few seconds to be applied. During this time the Database Instance connection remains uninterrupted. However, you must wait the few seconds before editing your advanced settings again.
     </Message>
   You can edit the `pgaudit.log` values in the advanced settings anytime.
 </TabsTab>


 <TabsTab label="for a specific database">


   1. [Connect to your database](/managed-databases/postgresql-and-mysql/how-to/connect-database-instance/) as an admin user.
   2. Run the following command to set `pgaudit.log` for the database. Replace `<database>` with the name of your database, and Â´<class>` with one or more of the statement class values listed above.
     ```
     database=> ALTER DATABASE <database> SET pgaudit.log = '<class>'
     ```
     If the operation is successful no output is returned.
   3. Reset the connection to your database to apply the configuration:
     ```
     database=> \q


     $ psql -h <ip-address> -p <port> -d <database-name> -U <username>
     ```
 </TabsTab>


</Tabs>


### Setting up `pgaudit.role`

The `pgaudit.role` allows object audit logging setting through the roles system.

When database activity occurs, the auditing system checks the role of the user performing the action. If the user belongs to a role that has an associated audit policy, the action is logged according to the rules defined in that policy.

specifies the master role for object audit logging.

The master role can be granted multiple audit roles. An audit role refers to a specific role assigned to users or groups that grants them the authority to perform auditing tasks within the Database Instance. Assigning audit roles allows for the delegation of auditing responsibilities to different individuals or teams within an organization.










## Deactivating pgaudit
e- If you want to deactivate pgaudit, use `DROP EXTENSION pgaudit` and in your Advanced Settings, change the `rdb.enable_pgaudit` parameter to False. If you activate it again afterwards, the same configuration as the one that was live before the deactivation will be applied immediately.




## Additional information
Logs are accessible via the standard PostgreSQL logging facility.
Logs format: https://github.com/pgaudit/pgaudit/blob/master/README.md#format
Object renames are logged under the name they were renamed to. (https://github.com/pgaudit/pgaudit/blob/master/README.md#caveats)
All management actions performed via API or console (e.g user/database creations and deletions) are logged, no matter the configuration. However the associated read statements are not logged (e.g select statements used to check that actions have been correctly executed).


## Recommendations
Audit logs are flushed, consuming disk space. Knowing that the log ingestion rate is 4MB per second (https://www.scaleway.com/en/docs/observability/cockpit/reference-content/cockpit-limitations/#limits-for-loki), the risk is log generation exceeding ingestion, leading to unwanted and uncontrolled growth of disk usage. If there is a risk, monitor closely the disk usage of the instance and think about updating accordingly the log_policy parameter (https://www.scaleway.com/en/developers/api/managed-database-postgre-mysql/#path-database-instances-update-a-database-instance). Keep also in mind that if the disk space is full, some audit logs may be lost.
Before activating any audit, make sure to define exactly which statements are mandatory. Some statements might not be important for auditing use cases (e.g SELECT) while generating high volume logs, taking up disk space. When it comes to SELECT and DML statements, we recommend opting for an object audit logging configuration rather than a session audit one. For more information: https://github.com/pgaudit/pgaudit?tab=readme-ov-file#usage-considerations




## Set up examples
Audit logging on all statements for all databases and roles
Set pgaudit.log = 'all' in the Advanced settings




Audit logging only on DML statements for all databases and roles
Set pgaudit.log = 'write' in the Advanced settings




Audit logging on all statements, only on one database named 'mydb'
Set pgaudit.log = 'none' in the Advanced settings
Connect to your instance as an admin user and use this command: `ALTER DATABASE mydb SET pgaudit.log = 'all'`




Audit logging for all statements except read, write for all databases and roles & audit logging on select, insert, update, delete statements only on a specific table named 'mytable' in a database named 'mydb'
Set pgaudit.log = 'function,role,ddl,misc,misc_set' & pgaudit.role = 'auditor' in the Advanced settings
Connect to your instance as an admin user and use this command: 'GRANT select, insert, update, delete on mydb.mytable to auditor'
When creating a new master role used for object audit logging, we recommend first revoking all his privileges before granting specific audit privileges, for better fine-tuning.





